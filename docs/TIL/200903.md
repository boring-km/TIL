# 0904 TIL
> **5장 스트림 코딩**
> - 5.3 스트림을 사용한 비동기 제어 흐름

## 5.3 스트림을 사용한 비동기 제어 흐름
- 비동기식 제어 흐름(control flow)을 흐름 제어(flow control)로 전환할 수 있다.
> **제어 흐름**은 프로그램이 실행 중일 때 함수 호출 및 명령문이 실행되거나 평가되는 순서이다.
> **흐름 제어**는 통신 장치와의 데이터 흐름의 차이를 보완하는 메커니즘 또는 코드이다.

### 5.3.1 순차 실행
- 비동기 작업을 순차적으로 처리하는데 스트림을 어떻게 사용할 것일까?

```javascript
// concatFile.js
// 입력으로 받은 일련의 파일을 연결하여 공급된 순서를 따르도록 하는 함수
const fromArray = require('from2-array');
const through = require('through2');
const fs = require('fs');

function concatFiles(destination, files, callback) {
    const destStream = fs.createWriteStream(destination);
    fromArray.obj(files)
        .pipe(through.obj((file, enc, done) => {
            const src = fs.createReadStream(file);
            src.pipe(destStream, { end: false });
            src.on('end', done);
        }))
        .on('finish', () => {
            destStream.end();
            callback();
        });
}
module.exports = concatFiles;
```

- 파일 배열(fromArray)에서 Readable 스트림 생성
- destination은 파일을 연결해서 저장할 대상파일
- 파일 연결이 끝나면 다음 파일 연결 시작을 위해 done 호출(through 라이브러리에 공개되어 있는 함수)
- 작업이 끝나면 finish 통해 callback 실행

### 5.3.2 비순차 병렬 실행
- 모든 데이터 덩어리들에 대해 느린 비동기 작업을 실행해야 하는 경우, 실행을 병렬화하고 전체 프로세스의 속도를 높이기
- 각각의 데이터 덩어리들이 서로 관계가 없는 경우에만 적용할 수 있다.
- 예제는 생략

### 5.3.3 제한된 비순차 병렬 실행
- 한 번에 감당할 수 없는 연결을 한꺼번에 생성하여 상당한 양의 데이터를 동시에 보내는 것은 잠재적으로 application의 안정성을 해치고 전체 시스템의 가용성을 떨어뜨린다.
- 부하와 리소스 사용을 제어하여 병렬 작업의 동시 실행을 제한하자
- concurrency와 continueCallback을 이용해 비순차 병렬 실행에서 조금 바꿔서 구현하면 된다.
- 예제 생략
